<div class="valentine-container" [class.transitioning]="isTransitioning()" [class.correct-feedback]="showFeedback() && isCorrect()" [class.wrong-feedback]="showFeedback() && !isCorrect()" [class.shake]="shakeScreen()">
  
  <!-- Animated Background Elements -->
  <div class="bg-gradient-overlay"></div>
  
  <!-- Bokeh Lights -->
  <div class="bokeh-container">
    @for (i of [1,2,3,4,5,6,7,8,9,10,11,12]; track i) {
      <div class="bokeh" [style.--i]="i"></div>
    }
  </div>
  
  <!-- Floating Hearts Background -->
  <div class="floating-hearts">
    @for (i of [1,2,3,4,5,6,7,8,9,10,11,12]; track i) {
      <div class="floating-heart" [style.--delay]="i * 0.4 + 's'">ğŸ’•</div>
    }
  </div>
  
  <!-- Sparkle Stars -->
  <div class="sparkle-stars">
    @for (i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]; track i) {
      <div class="sparkle-star" [style.--i]="i">âœ¨</div>
    }
  </div>
  
  <!-- Rising Petals -->
  <div class="petals-container">
    @for (i of [1,2,3,4,5,6,7,8]; track i) {
      <div class="petal" [style.--i]="i">ğŸŒ¸</div>
    }
  </div>

  <!-- Music Player -->
  <div class="music-controls">
    <div class="music-toggle" (click)="toggleMusic()">
      <span class="music-icon">{{ isMusicPlaying() ? 'ğŸ”Š' : 'ğŸ”‡' }}</span>
      <span class="music-text">{{ isMusicPlaying() ? 'Music On' : 'Music Off' }}</span>
    </div>
    <div class="volume-control">
      <span class="volume-icon">ğŸ”‰</span>
      <input 
        type="range" 
        min="0" 
        max="100" 
        [value]="volume()" 
        (input)="setVolume($event)"
        class="volume-slider">
      <span class="volume-icon">ğŸ”Š</span>
    </div>
  </div>
  <audio #audioPlayer loop>
    <source src="/song.mp3" type="audio/mpeg">
  </audio>
  <audio #correctSound>
    <source src="/correct.mp3" type="audio/mpeg">
  </audio>
  <audio #wrongSound>
    <source src="/wrong.mp3" type="audio/mpeg">
  </audio>

  <!-- Intro Screen -->
  @if (currentStep() === 0) {
    <div class="screen intro-screen">
      <!-- Floating Elements -->
      <div class="intro-floating-elements">
        <!-- Floating Hearts -->
        <div class="float-heart fh-1">ğŸ’•</div>
        <div class="float-heart fh-2">ğŸ’–</div>
        <div class="float-heart fh-3">ğŸ’—</div>
        <div class="float-heart fh-4">ğŸ’“</div>
        <div class="float-heart fh-5">ğŸ’</div>
        <div class="float-heart fh-6">â¤ï¸</div>
        <div class="float-heart fh-7">ğŸ’˜</div>
        <div class="float-heart fh-8">ğŸ’</div>
        
        <!-- Sparkles -->
        <div class="float-sparkle fs-1">âœ¨</div>
        <div class="float-sparkle fs-2">â­</div>
        <div class="float-sparkle fs-3">âœ¨</div>
        <div class="float-sparkle fs-4">ğŸ’«</div>
        <div class="float-sparkle fs-5">âœ¨</div>
        
        <!-- Rose Petals -->
        <div class="float-petal fp-1">ğŸŒ¸</div>
        <div class="float-petal fp-2">ğŸŒº</div>
        <div class="float-petal fp-3">ğŸŒ¸</div>
        <div class="float-petal fp-4">ğŸŒ·</div>
        <div class="float-petal fp-5">ğŸŒ¹</div>
        <div class="float-petal fp-6">ğŸŒ¸</div>
        
        <!-- Cupid Arrows -->
        <div class="float-cupid fc-1">ğŸ’˜</div>
        <div class="float-cupid fc-2">ğŸ¹</div>
      </div>
      
      <!-- Floating Photo Frames -->
      <div class="intro-photo-frame frame-left">
        <div class="photo-frame-inner">
          <img src="/intro-photo.jpg" alt="Us" onerror="this.style.display='none'">
        </div>
      </div>
      
      <div class="intro-photo-frame frame-right">
        <div class="photo-frame-inner">
          <img src="/photo1.jpg" alt="Us" onerror="this.style.display='none'">
        </div>
      </div>
      
      <div class="intro-content">
        <div class="cloud-bubble">
          <div class="bubble-decoration bubble-dec-1">ğŸ’•</div>
          <div class="bubble-decoration bubble-dec-2">âœ¨</div>
          <div class="bubble-decoration bubble-dec-3">ğŸ’–</div>
          
          <div class="heart-pulse">ğŸ’–</div>
          <h1 class="title">Valentine Quiz lik nty ya hob hyety</h1>
          <p class="subtitle">10 as2la lezmek tjibhom s7a7 zok</p>
          <p class="hint">khanchoufk qadeh taaref aalina ğŸ’•</p>
          <button class="start-btn" (click)="startQuiz()">
            Enzel 3asba
            <span class="btn-sparkle">âœ¨</span>
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Quiz Questions -->
  @if (currentStep() >= 1 && currentStep() <= 10) {
    <div class="screen quiz-screen">
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progress()"></div>
        </div>
        <span class="progress-text">{{ currentStep() }} of 10</span>
      </div>
      
      @if (currentQuestion(); as question) {
        <div class="question-card" [class.card-correct]="showFeedback() && isCorrect()" [class.card-wrong]="showFeedback() && !isCorrect()">
          <div class="question-emoji">{{ question.emoji }}</div>
          <h2 class="question-text">{{ question.text }}</h2>
          
          @if (showFeedback()) {
            <div class="feedback-container" [class.feedback-correct]="isCorrect()" [class.feedback-wrong]="!isCorrect()">
              <div class="feedback-icon">{{ isCorrect() ? 'ğŸ’š' : 'ğŸ’”' }}</div>
              <p class="feedback-message">{{ feedbackMessage() }}</p>
              @if (isCorrect()) {
                <button class="next-btn" (click)="goToNextQuestion()">
                  {{ currentStep() === 10 ? 'Continue to the Final Question ğŸ’' : 'Next Question â†’' }}
                </button>
              } @else {
                <button class="retry-btn" (click)="retryQuestion()">
                  Try Again ğŸ”„
                </button>
              }
            </div>
          } @else {
            <div class="options">
              @for (option of question.options; track option; let i = $index) {
                <button class="option-btn" (click)="selectAnswer(option, i)">
                  {{ option }}
                </button>
              }
            </div>
          }
        </div>
      }
    </div>
  }

  <!-- Valentine Question Screen -->
  @if (currentStep() === 11) {
    <div class="screen valentine-screen">
      <div class="valentine-content">
        <div class="big-heart">ğŸ’</div>
        <h1 class="valentine-question">Will you be my Valentine?</h1>
        <p class="valentine-subtext">You've been through our memories... now, one final question ğŸ’•</p>
        
        <div class="button-container">
          <button 
            class="yes-btn" 
            [style.transform]="'scale(' + yesButtonScale() + ')'"
            (click)="onYesClick()">
            Yes ğŸ’–
          </button>
          
          <button 
            class="no-btn"
            [style.transform]="'scale(' + noButtonScale() + ') translate(' + noButtonPosition().x + 'px, ' + noButtonPosition().y + 'px)'"
            (mouseenter)="onNoHover()"
            (touchstart)="onNoHover()">
            {{ noButtonText() }}
          </button>
        </div>
        
        @if (noAttempts() > 0) {
          <p class="tease-text">
            @switch (noAttempts()) {
              @case (1) { Oops! The button is shy ğŸ˜Š }
              @case (2) { It really doesn't want you to click it! ğŸ˜‚ }
              @case (3) { Maybe take the hint? ğŸ’• }
              @default { Just say YES already! ğŸ¥° }
            }
          </p>
        }
      </div>
    </div>
  }

  <!-- Celebration Screen -->
  @if (currentStep() === 12) {
    <div class="screen celebration-screen">
      <!-- Hearts Rain -->
      <div class="hearts-rain">
        @for (heart of hearts(); track heart.id) {
          <div 
            class="rain-heart"
            [style.left.%]="heart.left"
            [style.animation-delay]="heart.delay + 's'"
            [style.animation-duration]="heart.duration + 's'">
            ğŸ’–
          </div>
        }
      </div>
      
      <div class="celebration-content">
        <div class="confetti-burst">ğŸ‰</div>
        <h1 class="celebration-title">YES! ğŸ’–</h1>
        <div class="love-message">
          <p>Every moment with you is a treasure.</p>
          <p>Every smile you give me is a gift.</p>
          <p>Every day with you is an adventure.</p>
          <br>
          <p class="highlight">You are my favorite person,</p>
          <p class="highlight">my best friend,</p>
          <p class="highlight">and my forever Valentine.</p>
          <br>
          <p class="final-line">I love you more than words can say ğŸ’•</p>
        </div>
        <div class="hearts-row">
          ğŸ’• ğŸ’– ğŸ’— ğŸ’“ ğŸ’ ğŸ’•
        </div>
        <button class="letter-btn" (click)="goToLoveLetter()">
          Read My Letter to You ğŸ’Œ
        </button>
      </div>
    </div>
  }

  <!-- Love Letter Screen -->
  @if (currentStep() === 13) {
    <div class="screen letter-screen">
      
      <!-- Polaroids -->
      <div class="polaroids-container">
        <div class="polaroid polaroid-1">
          <div class="polaroid-image">
            <img src="/photo1.jpg" alt="Us" onerror="this.style.display='none'; this.parentElement.classList.add('placeholder')">
          </div>
          <p class="polaroid-caption">Our first pic ğŸ’•</p>
        </div>
        
        <div class="polaroid polaroid-2">
          <div class="polaroid-image">
            <img src="/photo2.jpg" alt="Us" onerror="this.style.display='none'; this.parentElement.classList.add('placeholder')">
          </div>
          <p class="polaroid-caption">Best memories ğŸ¥°</p>
        </div>
        
        <div class="polaroid polaroid-3">
          <div class="polaroid-image">
            <img src="/photo3.jpg" alt="Us" onerror="this.style.display='none'; this.parentElement.classList.add('placeholder')">
          </div>
          <p class="polaroid-caption">I love us ğŸ’–</p>
        </div>
        
        <div class="polaroid polaroid-4">
          <div class="polaroid-image">
            <img src="/photo4.jpg" alt="Us" onerror="this.style.display='none'; this.parentElement.classList.add('placeholder')">
          </div>
          <p class="polaroid-caption">Forever yours â¤ï¸</p>
        </div>
      </div>
      
      <div class="letter-container">
        <div class="letter-paper">
          <p class="letter-date">February 14, 2026</p>
          
          <p class="letter-greeting">To my favorite person in this whole world,</p>
          
          <div class="letter-content">
            <p>I've been sitting here for like an hour trying to figure out how to start this. How do you even put feelings like this into words?? I don't know, but I'm gonna try because you deserve to know all of it.</p>
            
            <p>First off â€” your laugh. God, your laugh. You know that thing you do when something's actually funny and you laugh so hard you can't breathe? That's literally my favorite sound ever. I could listen to it forever and never get tired of it.</p>
            
            <p>And the way you look at me sometimes?? Like when we're just chilling and I catch you staring and you get all embarrassed? That kills me every single time. In the best way possible.</p>
            
            <p>I love how you get SO excited about the smallest things. </p>
            
            <p>I love that you're weird. Like genuinely weird in the best way. The random voices you do, </p>
            
            <p>I love how safe I feel with you. Like I can tell you literally anything and you won't judge me. You've seen me at my worst and you're still here. Do you know how rare that is?? I don't take that for granted. Ever.</p>
            
            <p>The way you care about people â€” your friends, your family, random strangers even â€” it's one of the most beautiful things about you. You have the biggest heart of anyone I know.</p>
            
            <p>I love our inside jokes that no one else gets. I love how we can sit in silence and it's not awkward at all. I love how you ALWAYS take forever to get ready but it's fine because you always look perfect anyway.</p>
            
            <p>I love our late night talks about everything and nothing. The deep conversations about life at 2am. The way you listen to me ramble about stuff you probably don't even care about but you pretend to anyway.</p>
            
            <p>I love how you make me want to be better. Not because you ask me to change, but because loving you makes me want to be the kind of person who deserves someone like you.</p>
            
            <p>I love the little things you probably don't even notice. The way you scrunch your nose. All of it.</p>
            
          
  
            <p>I could keep going forever but this letter is already way too long. Just know that I love you. All of you. The good parts, the messy parts, the weird parts, everything.</p>
            
            <p>You're my best friend, my favorite hello and my hardest goodbye, my person. I can't imagine my life without you in it and honestly I don't want to.</p>
            
            <p>Thank you for being you. Thank you for loving me. Thank you for everything.</p>
            
            <p class="letter-closing">I love you more than you'll ever know. Today, tomorrow, and always. ğŸ’•</p>
            
            <p class="letter-signature">Forever yours,<br>Your Valentine â¤ï¸</p>
            
            <p class="letter-ps">P.S. â€” You're stuck with me now. No refunds. ğŸ˜˜</p>
          </div>
        </div>
        
        <div class="letter-hearts">
          ğŸ’• ğŸ’– ğŸ’— ğŸ’“ ğŸ’ ğŸ’•
        </div>
        
        <button class="certificate-btn" (click)="goToCertificate()">
          Sign Our Marriage Certificate ğŸ’
        </button>
      </div>
    </div>
  }

  <!-- Marriage Certificate Screen -->
  @if (currentStep() === 14) {
    <div class="screen certificate-screen">
      <div class="certificate-container">
        <div class="certificate">
          <div class="certificate-border">
            <div class="certificate-inner">
              <div class="certificate-header">
                <div class="certificate-ornament">ğŸ’•</div>
                <h1 class="certificate-title">Certificate of Love</h1>
                <p class="certificate-subtitle">Digital Marriage Certificate</p>
              </div>
              
              <div class="certificate-body">
                <p class="certificate-text">This certifies that</p>
                
                <div class="names-container">
                  <span class="spouse-name groom">Makrem Jemaa</span>
                  <span class="and-symbol">&</span>
                  <span class="spouse-name bride">Kenza Fathalli</span>
                </div>
                
                <p class="certificate-text">are united in love and commitment</p>
                <p class="certificate-text">from this day forward, for all eternity</p>
                
                <p class="certificate-date">February 14, 2026</p>
              </div>
              
              <div class="signature-section">
                <div class="signature-box">
                  <p class="signature-label">Bride's Signature</p>
                  <canvas 
                    #signatureCanvas
                    class="signature-canvas"
                    width="300"
                    height="100"
                    (mousedown)="startDrawing($event)"
                    (mousemove)="draw($event)"
                    (mouseup)="stopDrawing()"
                    (mouseleave)="stopDrawing()"
                    (touchstart)="startDrawing($event)"
                    (touchmove)="draw($event)"
                    (touchend)="stopDrawing()">
                  </canvas>
                </div>
              </div>
              
              @if (!hasSigned()) {
                <div class="signature-buttons">
                  <button class="clear-btn" (click)="clearSignature()">Clear</button>
                  <button class="sign-btn" (click)="submitSignature()">Sign Certificate ğŸ’</button>
                </div>
              }
              
              <!-- Official Stamp -->
              @if (showStamp()) {
                <div class="stamp-container">
                  <div class="stamp">
                    <div class="stamp-inner">
                      <span class="stamp-text-top">OFFICIALLY</span>
                      <span class="stamp-heart">ğŸ’•</span>
                      <span class="stamp-text-bottom">MARRIED</span>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
        
        @if (hasSigned()) {
          <button class="ring-btn" (click)="goToRingPage()">
            See Our Forever ğŸ’
          </button>
        }
      </div>
    </div>
  }

  <!-- Heart Forever Screen -->
  @if (currentStep() === 15) {
    <div class="screen ring-screen">
      <div class="ring-content">
        <div class="ring-photo-container">
          <img src="/ring.png" alt="Ring" class="ring-photo">
          <div class="ring-glow"></div>
          <div class="ring-sparkles">
            @for (i of [1,2,3,4,5,6,7,8]; track i) {
              <div class="ring-sparkle" [style.--i]="i">âœ¨</div>
            }
          </div>
        </div>
        
        <h1 class="forever-text">Forever</h1>
        
        <div class="names-forever">
          <span>Makrem</span>
          <span class="heart-divider">ğŸ’•</span>
          <span>Kenza</span>
        </div>
        
        <!-- Presents Section -->
        <div class="presents-section">
          <p class="presents-title">Open Your Gifts ğŸ</p>
          <div class="presents-row">
            @for (i of [1,2,3,4,5,6,7,8,9,10]; track i) {
              <div class="present" (click)="openPresent(i)" [class.opened]="openedPresent() === i">
                <div class="present-box">
                  <div class="present-lid"></div>
                  <div class="present-ribbon"></div>
                </div>
                <span class="present-number">{{ i }}</span>
              </div>
            }
          </div>
        </div>
        
        <!-- Video Modal -->
        @if (openedPresent() !== null) {
          <div class="video-modal" (click)="closeVideo()">
            <div class="video-container" (click)="$event.stopPropagation()">
              <button class="close-video-btn" (click)="closeVideo()">âœ•</button>
              <video #presentVideo controls autoplay>
                <source [src]="'/video' + openedPresent() + '.mp4'" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>
